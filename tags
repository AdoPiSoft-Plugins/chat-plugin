!_TAG_FILE_FORMAT	2	/extended format; --format=1 will not append ;" to lines/
!_TAG_FILE_SORTED	1	/0=unsorted, 1=sorted, 2=foldcase/
!_TAG_PROGRAM_AUTHOR	Darren Hiebert	/dhiebert@users.sourceforge.net/
!_TAG_PROGRAM_NAME	Exuberant Ctags	//
!_TAG_PROGRAM_URL	http://ctags.sourceforge.net	/official site/
!_TAG_PROGRAM_VERSION	5.8	//
App	assets/scripts/admin/chat_ctrl.js	/^(function(){"use strict";var App=angular.module("Plugins");App.component("chats",{controller:"ChatsCtrl",templateUrl:"\/public\/plugins\/chat-plugin\/views\/admin\/chats.html",bindings:{contact:"="}}).controller("ChatsCtrl",function($scope,ChatService,DevicesService,toastr,CatchHttpError,$timeout,$ngConfirm,Socket){var socket=Socket.getSocket();var _this=this;var scrollToBottom=function(){$timeout(function(){var scroll=$(".conversation");scroll.animate({scrollTop:scroll.prop("scrollHeight")})});$timeout(function(){$(".conversation .message").css("border","")},1500)};$scope.page=1;this.$doCheck=function(){if(_this.contact&&($scope.contact||{}).id!=_this.contact.id){$scope.page=1;$scope.contact=angular.copy(_this.contact);var opts={page:$scope.page};$scope.has_more=false;ChatService.getClientMessages($scope.contact.id,opts).then(function(res){var data=res.data||{};$scope.chats=(data.chats||[]).reverse();$scope.has_more=data.total_count>$scope.chats.length;scrollToBottom()}).finally(function(){$scope.loadingMessages=false});DevicesService.getDeviceData($scope.contact.id).then(function(res){var data=res.data||{};$scope.contact.is_muted=!!data.is_muted})}};var loading_more=false;$scope.loadMore=function(){if(loading_more)return;$scope.page+=1;var opts={page:$scope.page};loading_more=true;ChatService.getClientMessages($scope.contact.id,opts).then(function(res){loading_more=false;var data=res.data||{};var chats=(data.chats||[]).reverse().concat($scope.chats);$scope.chats=_.uniq(chats,function(i){return i.id});$scope.has_more=data.total_count>$scope.chats.length})};$scope.closeChat=function(){$scope.$parent.closeChat()};$scope.send=function(e){e.preventDefault();var opts={message:$scope.msg};$scope.sending=true;ChatService.sendToClient($scope.contact.id,opts).then(function(res){$scope.msg="";scrollToBottom()}).finally(function(){$scope.sending=false})};$scope.deleteConversation=function(){if($scope.chats.length<=0)return;$ngConfirm({title:"Confirm",content:"Are you sure you want to delete this conversation?",escapeKey:"close",buttons:{ok:{text:"Yes",btnClass:"btn-danger",keys:["enter"],action:function(){$scope.deleting=true;ChatService.deleteConversation($scope.contact.id).then(function(res){$scope.chats=[];$scope.has_more=false;$scope.page=1}).finally(function(){$scope.deleting=false})}},close:{text:"Cancel",keys:["escape"],btnClass:"btn-default"}}})};$scope.muteDevice=function(device){return DevicesService.muteDevice(device.id).then(function(){device.is_muted=true;toastr.success(device.hostname+" successfully muted")})};$scope.unmuteDevice=function(device){return DevicesService.unmuteDevice(device.id).then(function(){device.is_muted=false;toastr.success(device.hostname+" successfully unmuted")})};socket.on("chat",function(chat){if($(".conversation.device-"+chat.mobile_device_id+":visible").length){var exists=_.findIndex($scope.chats,function(c){return c.id==chat.id})>=0;if(exists)return;$scope.chats.push(chat);scrollToBottom();ChatService.markMessagesRead(chat.mobile_device_id).then(function(){$(".conversation .message:last:not(.placeholder)").css("border","5px solid #209e91");if($(`.conversation.device-${_this.contact.id}`).is(":visible")){_this.contact.has_unread=false}$(".device-"+chat.mobile_device_id+" .unread-indicator").hide()})}})})})();/;"	v
App	assets/scripts/admin/contacts_ctrl.js	/^function array_move(arr,old_index,new_index){if(new_index>=arr.length){var k=new_index-arr.length+1;while(k--){arr.push(undefined)}}arr.splice(new_index,0,arr.splice(old_index,1)[0]);return arr}(function(){"use strict";var App=angular.module("Plugins");App.component("contacts",{controller:"ContactsCtrl",templateUrl:"\/public\/plugins\/chat-plugin\/views\/admin\/contacts.html"}).controller("ContactsCtrl",function($scope,DevicesService,toastr,CatchHttpError,$timeout,ChatService,$ngConfirm,Socket){var socket=Socket.getSocket();$scope.page=1;$scope.loadContacts=function(opts){$scope.page=1;$scope.has_more=false;DevicesService.get(opts).then(function(res){var data=res.data||{};$scope.devices=data.devices||[];$scope.$parent.has_unread=_.findIndex($scope.devices,function(d){return d.has_unread})>=0;$scope.has_more=data.devices.length>0&&data.total_count>$scope.devices.length})};$scope.loadMore=function(){$scope.page+=1;var opts={page:$scope.page,q:$scope.search};$scope.has_more=false;DevicesService.get(opts).then(function(res){var data=res.data||{};$scope.devices=$scope.devices.concat(data.devices);$scope.devices=_.uniq($scope.devices,function(d){return d.id});$scope.has_more=data.devices.length>0&&data.total_count>$scope.devices.length})};$scope.loadContacts({page:$scope.page});$scope.searchContacts=function(){$scope.loadContacts({page:$scope.page,q:$scope.search})};$scope.focusChat=function(contact){$scope.$parent.focusChat(contact);ChatService.markMessagesRead(contact.id).then(function(){contact.has_unread=false;$scope.$parent.has_unread=_.findIndex($scope.devices,function(d){return d.has_unread})>=0})};$scope.messageAll=function(e){e.preventDefault();$ngConfirm({title:"Confirm",content:"Are you sure you want to send this message to all your online customers?",escapeKey:"close",buttons:{ok:{text:"Yes",btnClass:"btn-danger",keys:["enter"],action:function(){var msg=angular.copy($scope.msg_all);var sent=false;$scope.sending=true;ChatService.bulkSendToClients($scope.msg_all).then(function(res){sent=true}).finally(function(){if(!sent)$scope.msg_all=msg;$scope.sending=false});$scope.msg_all=""}},close:{text:"Cancel",keys:["escape"],btnClass:"btn-default"}}})};$scope.loadDevice=function(device_id){return DevicesService.getDeviceData(device_id).then(function(res){var device=res.data;var exists=_.findIndex($scope.devices,function(d){return d.id==device_id})>=0;if(!exists){$scope.devices.unshift(device)}return device})};var audio=new Audio;audio.src="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg2.mp3";audio.load();socket.on("chat",function(chat){if(chat.sender_id){var dIndex=_.findIndex($scope.devices,function(d){return d.id==chat.sender_id});if(dIndex>=0){var device=$scope.devices[dIndex];device.has_unread=true;$scope.devices=array_move($scope.devices,dIndex,0)}else{$scope.loadDevice(chat.sender_id).then(function(d){d.has_unread=true}).catch(function(e){})}$timeout(function(){$scope.$parent.has_unread=_.findIndex($scope.devices,function(d){return d.has_unread})>=0},500);audio.play();$(".device-"+chat.mobile_device_id+" .unread-indicator").show()}})})})();/;"	v
App	assets/scripts/admin/services.js	/^(function(){"use strict";var App=angular.module("Plugins");App.service("ChatService",["$http","toastr","CatchHttpError","$q",function($http,toastr,CatchHttpError,$q){this.getClientMessages=function(mobile_device_id,opts){var query=!!opts?jQuery.param(opts):"";query=query+"&ref="+Math.random();return $http.get("\/chat-plugin\/chats\/"+mobile_device_id+"?"+query).catch(CatchHttpError)};this.sendToClient=function(mobile_device_id,opts){return $http.post("\/chat-plugin\/chats\/"+mobile_device_id,opts).catch(CatchHttpError)};this.bulkSendToClients=function(message){return $http.post("\/chat-plugin\/chats\/bulk-send",{message:message}).catch(CatchHttpError)};this.deleteConversation=function(mobile_device_id){return $http.delete("\/chat-plugin\/chats\/"+mobile_device_id).catch(CatchHttpError)};this.markMessagesRead=function(mobile_device_id){return $http.post("\/chat-plugin\/chats\/"+mobile_device_id+"\/mark-read").catch(CatchHttpError)};this.getSettings=function(){return $http.get("\/chat-plugin\/setting").catch(CatchHttpError)};this.updateSettings=function(params){return $http.post("\/chat-plugin\/setting",params).catch(CatchHttpError)}}]).service("DevicesService",["$http","toastr","CatchHttpError","$q",function($http,toastr,CatchHttpError,$q){this.get=function(opts){var query=!!opts?jQuery.param(opts):"";return $http.get("\/chat-plugin\/devices?"+query).catch(CatchHttpError)};this.getDeviceData=function(mobile_device_id){return $http.get("\/chat-plugin\/device\/"+mobile_device_id)};this.muteDevice=function(mobile_device_id){return $http.post("\/chat-plugin\/chats\/"+mobile_device_id+"\/mute").catch(CatchHttpError)};this.unmuteDevice=function(mobile_device_id){return $http.post("\/chat-plugin\/chats\/"+mobile_device_id+"\/unmute").catch(CatchHttpError)}}])})();/;"	v
App	assets/scripts/admin/settings_ctrl.js	/^(function(){"use strict";var App=angular.module("Plugins");App.controller("ChatPluginSettingsCtrl",function($scope,ChatService,Upload,CatchHttpError,toastr){var default_apk="\/plugins\/chat-plugin\/assets\/captive-portal.apk";ChatService.getSettings().then(function(cfg){var data=cfg.data;$scope.apk_download_prompt=data.apk_download_prompt||"We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";$scope.apk_link=data.apk_link||default_apk;$scope.hide_portal_button=data.hide_portal_button;$scope.apk_type=$scope.apk_link==default_apk||$scope.apk_link.includes("http")?"link":"upload_file";$scope.apk_file=null});$scope.submit=function(){var cfg={apk_download_prompt:$scope.apk_download_prompt,facebook:$scope.facebook,apk_link:$scope.apk_link,hide_portal_button:$scope.hide_portal_button};ChatService.updateSettings(cfg).then(function(){toastr.success("Plugin settings successfully saved")})};$scope.uploadApk=function(file){if(file){Upload.upload({url:"\/chat-plugin\/upload-apk",data:{file:file}}).then(function(res){$scope.apk_link=(res.data||{}).apk_link}).catch(CatchHttpError)}};$scope.resetApk=function(){$("input[name='apk_file']").val("");$scope.apk_link=default_apk;$scope.apk_type="link";return $scope.submit()}})})();/;"	v
Chat	models/index.js	/^"use strict";var{dbi,machine_id}=require("plugin-core");var Chat=require(".\/chat");var MutedDevice=require(".\/muted_device");var model_files={Chat:Chat,MutedDevice:MutedDevice};exports.init=async()=>{if(!dbi)return;var{sequelize,Sequelize}=dbi;var db=await sequelize.getInstance();var keys=Object.keys(model_files);for(var i=0;i<keys.length;i++){var k=keys[i];dbi.models[k]=model_files[k](db,Sequelize);try{await dbi.models[k].sync({alter:true})}catch(e){}}var default_scope={where:{machine_id:machine_id}};dbi.models.Chat.addScope("default_scope",default_scope);dbi.models.Chat.belongsTo(dbi.models.MobileDevice);dbi.models.MobileDevice.hasMany(dbi.models.Chat);dbi.models.MutedDevice.addScope("default_scope",default_scope);dbi.models.MutedDevice.belongsTo(dbi.models.MobileDevice);return dbi};/;"	v
MainApp	assets/scripts/admin/chat_plugin_ctrl.js	/^    <\/div>`;if($("#chat-plugin").length<=0)$("body").append(chat_plugin);var App=angular.module("Plugins");App.controller("ChatPluginCtrl",function($scope,toastr,CatchHttpError,$timeout){$scope.toggleContacts=function(){$scope.showContacts=!$scope.showContacts};$scope.focusChat=function(contact){$scope.active_contact=contact;$(".device-"+contact.id+" .unread-indicator").hide()};$scope.closeChat=function(){$scope.active_contact=null}});function renderChatButtons(){var list=$("all-devices table tbody tr");if(!list.length)return;var contactScope=angular.element(".contacts-bar").scope();$.get("\/chat-plugin\/unread-device-ids").then(function(data){for(var i=0;i<list.length;i++){let tr=$(list[i]);let td=tr.children().last();if(!td.children(".init-chat").length){let scope=angular.element(tr).scope();let device=scope.c;let chatBtn='<button class="btn btn-info btn-xs init-chat device-'+device.id+'" title="Chat"><i class="fa fa-envelope-o"><\/i>';let hasUnread=data.includes(device.id);chatBtn+='<i class="unread-indicator" style="display:'+(hasUnread?"inline":"none")+';position:absolute;color:red;font-size:30px;margin-top:-14px;">*<\/i>';chatBtn+="<\/button>";chatBtn=$(chatBtn);td.append(chatBtn);chatBtn.on("click",function(){$(this).children(".unread-indicator").hide();var _device=contactScope.devices.find(function(d){return d.id==device.id});if(!_device)_device=device;contactScope.focusChat(_device)})}}})}var MainApp=angular.module("adopisoft");MainApp.config(function($httpProvider){$httpProvider.interceptors.push("clientsLoadFilter")}).factory("clientsLoadFilter",function($q,$rootScope){var service={request:function(d){return d},response:function(d){var url=((d||{}).config||{}).url||"";if(!d.data)return d;if(!url.includes("\/settings\/clients"))return d;setTimeout(function(){renderChatButtons()});return d},responseError:function(rejection){return $q.reject(rejection)}};return service})})();/;"	v
MutedDevice	models/index.js	/^"use strict";var{dbi,machine_id}=require("plugin-core");var Chat=require(".\/chat");var MutedDevice=require(".\/muted_device");var model_files={Chat:Chat,MutedDevice:MutedDevice};exports.init=async()=>{if(!dbi)return;var{sequelize,Sequelize}=dbi;var db=await sequelize.getInstance();var keys=Object.keys(model_files);for(var i=0;i<keys.length;i++){var k=keys[i];dbi.models[k]=model_files[k](db,Sequelize);try{await dbi.models[k].sync({alter:true})}catch(e){}}var default_scope={where:{machine_id:machine_id}};dbi.models.Chat.addScope("default_scope",default_scope);dbi.models.Chat.belongsTo(dbi.models.MobileDevice);dbi.models.MobileDevice.hasMany(dbi.models.Chat);dbi.models.MutedDevice.addScope("default_scope",default_scope);dbi.models.MutedDevice.belongsTo(dbi.models.MobileDevice);return dbi};/;"	v
apk_download_prompt	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	v
apk_link	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	v
array_move	assets/scripts/admin/contacts_ctrl.js	/^function array_move(arr,old_index,new_index){if(new_index>=arr.length){var k=new_index-arr.length+1;while(k--){arr.push(undefined)}}arr.splice(new_index,0,arr.splice(old_index,1)[0]);return arr}(function(){"use strict";var App=angular.module("Plugins");App.component("contacts",{controller:"ContactsCtrl",templateUrl:"\/public\/plugins\/chat-plugin\/views\/admin\/contacts.html"}).controller("ContactsCtrl",function($scope,DevicesService,toastr,CatchHttpError,$timeout,ChatService,$ngConfirm,Socket){var socket=Socket.getSocket();$scope.page=1;$scope.loadContacts=function(opts){$scope.page=1;$scope.has_more=false;DevicesService.get(opts).then(function(res){var data=res.data||{};$scope.devices=data.devices||[];$scope.$parent.has_unread=_.findIndex($scope.devices,function(d){return d.has_unread})>=0;$scope.has_more=data.devices.length>0&&data.total_count>$scope.devices.length})};$scope.loadMore=function(){$scope.page+=1;var opts={page:$scope.page,q:$scope.search};$scope.has_more=false;DevicesService.get(opts).then(function(res){var data=res.data||{};$scope.devices=$scope.devices.concat(data.devices);$scope.devices=_.uniq($scope.devices,function(d){return d.id});$scope.has_more=data.devices.length>0&&data.total_count>$scope.devices.length})};$scope.loadContacts({page:$scope.page});$scope.searchContacts=function(){$scope.loadContacts({page:$scope.page,q:$scope.search})};$scope.focusChat=function(contact){$scope.$parent.focusChat(contact);ChatService.markMessagesRead(contact.id).then(function(){contact.has_unread=false;$scope.$parent.has_unread=_.findIndex($scope.devices,function(d){return d.has_unread})>=0})};$scope.messageAll=function(e){e.preventDefault();$ngConfirm({title:"Confirm",content:"Are you sure you want to send this message to all your online customers?",escapeKey:"close",buttons:{ok:{text:"Yes",btnClass:"btn-danger",keys:["enter"],action:function(){var msg=angular.copy($scope.msg_all);var sent=false;$scope.sending=true;ChatService.bulkSendToClients($scope.msg_all).then(function(res){sent=true}).finally(function(){if(!sent)$scope.msg_all=msg;$scope.sending=false});$scope.msg_all=""}},close:{text:"Cancel",keys:["escape"],btnClass:"btn-default"}}})};$scope.loadDevice=function(device_id){return DevicesService.getDeviceData(device_id).then(function(res){var device=res.data;var exists=_.findIndex($scope.devices,function(d){return d.id==device_id})>=0;if(!exists){$scope.devices.unshift(device)}return device})};var audio=new Audio;audio.src="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg2.mp3";audio.load();socket.on("chat",function(chat){if(chat.sender_id){var dIndex=_.findIndex($scope.devices,function(d){return d.id==chat.sender_id});if(dIndex>=0){var device=$scope.devices[dIndex];device.has_unread=true;$scope.devices=array_move($scope.devices,dIndex,0)}else{$scope.loadDevice(chat.sender_id).then(function(d){d.has_unread=true}).catch(function(e){})}$timeout(function(){$scope.$parent.has_unread=_.findIndex($scope.devices,function(d){return d.has_unread})>=0},500);audio.play();$(".device-"+chat.mobile_device_id+" .unread-indicator").show()}})})})();/;"	f
chatBoxOpened	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	v
chat_plugin	assets/scripts/admin/chat_plugin_ctrl.js	/^(function(){"use strict";$(document).on("keypress","textarea",function(e){if(e.which==13&&!e.shiftKey){e.preventDefault();$(this).closest("form").submit()}});var chat_plugin=`<div id='chat-plugin' ng-controller='ChatPluginCtrl'>$/;"	v
chats_api_url	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	v
config	index.js	/^var config=require(".\/config");var router=require(".\/router");var models=require(".\/models");var{app}=require("plugin-core");module.exports={async init(id){config.id=id;await models.init();app.use(router)},uninstall(){}};/;"	v
core	controllers/devices_ctrl.js	/^"use strict";var core=require("plugin-core");var notification=require("..\/store\/notification");var default_per_page=20;exports.get=async(req,res,next)=>{try{var{dbi}=core;var{page,q,per_page}=req.query;if(!per_page)per_page=default_per_page;if(!page)page=1;var limit=parseInt(per_page);var offset=(page-1)*limit;var sequelize=dbi.Sequelize;var{Op}=sequelize;var search_q=q;var where={};if(search_q){search_q=search_q.toLowerCase();where[Op.or]=[sequelize.where(sequelize.fn("lower",sequelize.col("hostname")),{[Op.like]:`%${search_q}%`}),sequelize.where(sequelize.fn("lower",sequelize.col("mac_address")),{[Op.like]:`%${search_q}%`}),sequelize.where(sequelize.fn("lower",sequelize.col("ip_address")),{[Op.like]:`%${search_q}%`})];var statuses=["connected","disconnected"];if(statuses.includes(search_q)){where[Op.or].push({status:{[Op.eq]:search_q}})}}var total_count=await dbi.models.MobileDevice.scope(["default_scope"]).count({where:where});var result=await dbi.models.MobileDevice.scope(["default_scope"]).findAll({distinct:true,where:where,limit:limit,offset:offset,include:[{model:dbi.models.Chat,order:[["is_read_by_admin","ASC"]],limit:1,required:false}],order:[["active","DESC"]]});var devices=result.map(d=>{d=d.toJSON();d.has_unread=d.Chats.filter(c=>!c.is_read_by_admin).length>0;return d}).sort(d=>!d.has_unread);res.json({devices:devices,count:devices.length,total_count:total_count})}catch(e){next(e)}};exports.getDeviceData=async(req,res,next)=>{try{var{mobile_device_id}=req.params;var is_muted=!!await core.dbi.models.MutedDevice.findOne({where:{mobile_device_id:mobile_device_id}});var device=await core.devices_manager.loadDevice(mobile_device_id);res.json(Object.assign(device.toJSON(),{is_muted:is_muted}))}catch(e){next(e)}};exports.muteDevice=async(req,res,next)=>{try{var{mobile_device_id}=req.params;var device=await core.devices_manager.loadDevice(mobile_device_id);await core.dbi.models.MutedDevice.create({machine_id:core.machine_id,mobile_device_id:mobile_device_id,muted_at:new Date});device.emit("chat:mute");res.json({})}catch(e){next(e)}};exports.unmuteDevice=async(req,res,next)=>{try{var{mobile_device_id}=req.params;var device=await core.devices_manager.loadDevice(mobile_device_id);await core.dbi.models.MutedDevice.destroy({where:{mobile_device_id:mobile_device_id}});device.emit("chat:unmute");res.json({})}catch(e){next(e)}};exports.getUnreadDeviceIds=async(req,res,next)=>{try{var result=await core.dbi.models.Chat.findAll({where:{is_read_by_admin:false},distinct:true,attributes:["mobile_device_id"]});var mobile_device_ids=result.map(r=>r.mobile_device_id);res.json(mobile_device_ids)}catch(e){next(e)}};exports.getNotifications=async(req,res,next)=>{try{var{device}=req;await notification.subscribe(device);var[notif]=notification.get(device.db_instance.id)||[];res.json(notif||{})}catch(e){next(e)}};/;"	v
default_per_page	controllers/devices_ctrl.js	/^"use strict";var core=require("plugin-core");var notification=require("..\/store\/notification");var default_per_page=20;exports.get=async(req,res,next)=>{try{var{dbi}=core;var{page,q,per_page}=req.query;if(!per_page)per_page=default_per_page;if(!page)page=1;var limit=parseInt(per_page);var offset=(page-1)*limit;var sequelize=dbi.Sequelize;var{Op}=sequelize;var search_q=q;var where={};if(search_q){search_q=search_q.toLowerCase();where[Op.or]=[sequelize.where(sequelize.fn("lower",sequelize.col("hostname")),{[Op.like]:`%${search_q}%`}),sequelize.where(sequelize.fn("lower",sequelize.col("mac_address")),{[Op.like]:`%${search_q}%`}),sequelize.where(sequelize.fn("lower",sequelize.col("ip_address")),{[Op.like]:`%${search_q}%`})];var statuses=["connected","disconnected"];if(statuses.includes(search_q)){where[Op.or].push({status:{[Op.eq]:search_q}})}}var total_count=await dbi.models.MobileDevice.scope(["default_scope"]).count({where:where});var result=await dbi.models.MobileDevice.scope(["default_scope"]).findAll({distinct:true,where:where,limit:limit,offset:offset,include:[{model:dbi.models.Chat,order:[["is_read_by_admin","ASC"]],limit:1,required:false}],order:[["active","DESC"]]});var devices=result.map(d=>{d=d.toJSON();d.has_unread=d.Chats.filter(c=>!c.is_read_by_admin).length>0;return d}).sort(d=>!d.has_unread);res.json({devices:devices,count:devices.length,total_count:total_count})}catch(e){next(e)}};exports.getDeviceData=async(req,res,next)=>{try{var{mobile_device_id}=req.params;var is_muted=!!await core.dbi.models.MutedDevice.findOne({where:{mobile_device_id:mobile_device_id}});var device=await core.devices_manager.loadDevice(mobile_device_id);res.json(Object.assign(device.toJSON(),{is_muted:is_muted}))}catch(e){next(e)}};exports.muteDevice=async(req,res,next)=>{try{var{mobile_device_id}=req.params;var device=await core.devices_manager.loadDevice(mobile_device_id);await core.dbi.models.MutedDevice.create({machine_id:core.machine_id,mobile_device_id:mobile_device_id,muted_at:new Date});device.emit("chat:mute");res.json({})}catch(e){next(e)}};exports.unmuteDevice=async(req,res,next)=>{try{var{mobile_device_id}=req.params;var device=await core.devices_manager.loadDevice(mobile_device_id);await core.dbi.models.MutedDevice.destroy({where:{mobile_device_id:mobile_device_id}});device.emit("chat:unmute");res.json({})}catch(e){next(e)}};exports.getUnreadDeviceIds=async(req,res,next)=>{try{var result=await core.dbi.models.Chat.findAll({where:{is_read_by_admin:false},distinct:true,attributes:["mobile_device_id"]});var mobile_device_ids=result.map(r=>r.mobile_device_id);res.json(mobile_device_ids)}catch(e){next(e)}};exports.getNotifications=async(req,res,next)=>{try{var{device}=req;await notification.subscribe(device);var[notif]=notification.get(device.db_instance.id)||[];res.json(notif||{})}catch(e){next(e)}};/;"	v
device	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	v
device_api_url	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	v
function.disconnected	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
function.reconnected	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
hasUnread.hasRead	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
hide_portal_button	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	v
mark_read_api_url	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	v
model_files.Chat	models/index.js	/^"use strict";var{dbi,machine_id}=require("plugin-core");var Chat=require(".\/chat");var MutedDevice=require(".\/muted_device");var model_files={Chat:Chat,MutedDevice:MutedDevice};exports.init=async()=>{if(!dbi)return;var{sequelize,Sequelize}=dbi;var db=await sequelize.getInstance();var keys=Object.keys(model_files);for(var i=0;i<keys.length;i++){var k=keys[i];dbi.models[k]=model_files[k](db,Sequelize);try{await dbi.models[k].sync({alter:true})}catch(e){}}var default_scope={where:{machine_id:machine_id}};dbi.models.Chat.addScope("default_scope",default_scope);dbi.models.Chat.belongsTo(dbi.models.MobileDevice);dbi.models.MobileDevice.hasMany(dbi.models.Chat);dbi.models.MutedDevice.addScope("default_scope",default_scope);dbi.models.MutedDevice.belongsTo(dbi.models.MobileDevice);return dbi};/;"	p
model_files.MutedDevice	models/index.js	/^"use strict";var{dbi,machine_id}=require("plugin-core");var Chat=require(".\/chat");var MutedDevice=require(".\/muted_device");var model_files={Chat:Chat,MutedDevice:MutedDevice};exports.init=async()=>{if(!dbi)return;var{sequelize,Sequelize}=dbi;var db=await sequelize.getInstance();var keys=Object.keys(model_files);for(var i=0;i<keys.length;i++){var k=keys[i];dbi.models[k]=model_files[k](db,Sequelize);try{await dbi.models[k].sync({alter:true})}catch(e){}}var default_scope={where:{machine_id:machine_id}};dbi.models.Chat.addScope("default_scope",default_scope);dbi.models.Chat.belongsTo(dbi.models.MobileDevice);dbi.models.MobileDevice.hasMany(dbi.models.Chat);dbi.models.MutedDevice.addScope("default_scope",default_scope);dbi.models.MutedDevice.belongsTo(dbi.models.MobileDevice);return dbi};/;"	p
model_name	models/chat.js	/^"use strict";var model_name="Chat";var table_name="chats";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},sender_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},admin_username:{type:Sequelize.STRING},message:{type:Sequelize.TEXT},is_read_by_user:{type:Sequelize.BOOLEAN,defaultValue:true},is_read_by_admin:{type:Sequelize.BOOLEAN,defaultValue:true},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	v
model_name	models/muted_device.js	/^"use strict";var model_name="MutedDevice";var table_name="muted_devices";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},muted_at:{type:Sequelize.DATE},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	v
models	index.js	/^var config=require(".\/config");var router=require(".\/router");var models=require(".\/models");var{app}=require("plugin-core");module.exports={async init(id){config.id=id;await models.init();app.use(router)},uninstall(){}};/;"	v
mute.unmute	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
notification	controllers/devices_ctrl.js	/^"use strict";var core=require("plugin-core");var notification=require("..\/store\/notification");var default_per_page=20;exports.get=async(req,res,next)=>{try{var{dbi}=core;var{page,q,per_page}=req.query;if(!per_page)per_page=default_per_page;if(!page)page=1;var limit=parseInt(per_page);var offset=(page-1)*limit;var sequelize=dbi.Sequelize;var{Op}=sequelize;var search_q=q;var where={};if(search_q){search_q=search_q.toLowerCase();where[Op.or]=[sequelize.where(sequelize.fn("lower",sequelize.col("hostname")),{[Op.like]:`%${search_q}%`}),sequelize.where(sequelize.fn("lower",sequelize.col("mac_address")),{[Op.like]:`%${search_q}%`}),sequelize.where(sequelize.fn("lower",sequelize.col("ip_address")),{[Op.like]:`%${search_q}%`})];var statuses=["connected","disconnected"];if(statuses.includes(search_q)){where[Op.or].push({status:{[Op.eq]:search_q}})}}var total_count=await dbi.models.MobileDevice.scope(["default_scope"]).count({where:where});var result=await dbi.models.MobileDevice.scope(["default_scope"]).findAll({distinct:true,where:where,limit:limit,offset:offset,include:[{model:dbi.models.Chat,order:[["is_read_by_admin","ASC"]],limit:1,required:false}],order:[["active","DESC"]]});var devices=result.map(d=>{d=d.toJSON();d.has_unread=d.Chats.filter(c=>!c.is_read_by_admin).length>0;return d}).sort(d=>!d.has_unread);res.json({devices:devices,count:devices.length,total_count:total_count})}catch(e){next(e)}};exports.getDeviceData=async(req,res,next)=>{try{var{mobile_device_id}=req.params;var is_muted=!!await core.dbi.models.MutedDevice.findOne({where:{mobile_device_id:mobile_device_id}});var device=await core.devices_manager.loadDevice(mobile_device_id);res.json(Object.assign(device.toJSON(),{is_muted:is_muted}))}catch(e){next(e)}};exports.muteDevice=async(req,res,next)=>{try{var{mobile_device_id}=req.params;var device=await core.devices_manager.loadDevice(mobile_device_id);await core.dbi.models.MutedDevice.create({machine_id:core.machine_id,mobile_device_id:mobile_device_id,muted_at:new Date});device.emit("chat:mute");res.json({})}catch(e){next(e)}};exports.unmuteDevice=async(req,res,next)=>{try{var{mobile_device_id}=req.params;var device=await core.devices_manager.loadDevice(mobile_device_id);await core.dbi.models.MutedDevice.destroy({where:{mobile_device_id:mobile_device_id}});device.emit("chat:unmute");res.json({})}catch(e){next(e)}};exports.getUnreadDeviceIds=async(req,res,next)=>{try{var result=await core.dbi.models.Chat.findAll({where:{is_read_by_admin:false},distinct:true,attributes:["mobile_device_id"]});var mobile_device_ids=result.map(r=>r.mobile_device_id);res.json(mobile_device_ids)}catch(e){next(e)}};exports.getNotifications=async(req,res,next)=>{try{var{device}=req;await notification.subscribe(device);var[notif]=notification.get(device.db_instance.id)||[];res.json(notif||{})}catch(e){next(e)}};/;"	v
notify.animateIcon	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
notify.capitalize	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
notify.formatDate	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
notify.scrollToBottom	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
opts.createdAt	models/chat.js	/^"use strict";var model_name="Chat";var table_name="chats";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},sender_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},admin_username:{type:Sequelize.STRING},message:{type:Sequelize.TEXT},is_read_by_user:{type:Sequelize.BOOLEAN,defaultValue:true},is_read_by_admin:{type:Sequelize.BOOLEAN,defaultValue:true},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	p
opts.createdAt	models/muted_device.js	/^"use strict";var model_name="MutedDevice";var table_name="muted_devices";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},muted_at:{type:Sequelize.DATE},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	p
opts.tableName	models/chat.js	/^"use strict";var model_name="Chat";var table_name="chats";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},sender_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},admin_username:{type:Sequelize.STRING},message:{type:Sequelize.TEXT},is_read_by_user:{type:Sequelize.BOOLEAN,defaultValue:true},is_read_by_admin:{type:Sequelize.BOOLEAN,defaultValue:true},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	p
opts.tableName	models/muted_device.js	/^"use strict";var model_name="MutedDevice";var table_name="muted_devices";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},muted_at:{type:Sequelize.DATE},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	p
opts.timestamps	models/chat.js	/^"use strict";var model_name="Chat";var table_name="chats";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},sender_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},admin_username:{type:Sequelize.STRING},message:{type:Sequelize.TEXT},is_read_by_user:{type:Sequelize.BOOLEAN,defaultValue:true},is_read_by_admin:{type:Sequelize.BOOLEAN,defaultValue:true},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	p
opts.timestamps	models/muted_device.js	/^"use strict";var model_name="MutedDevice";var table_name="muted_devices";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},muted_at:{type:Sequelize.DATE},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	p
opts.underscored	models/chat.js	/^"use strict";var model_name="Chat";var table_name="chats";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},sender_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},admin_username:{type:Sequelize.STRING},message:{type:Sequelize.TEXT},is_read_by_user:{type:Sequelize.BOOLEAN,defaultValue:true},is_read_by_admin:{type:Sequelize.BOOLEAN,defaultValue:true},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	p
opts.underscored	models/muted_device.js	/^"use strict";var model_name="MutedDevice";var table_name="muted_devices";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},muted_at:{type:Sequelize.DATE},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	p
opts.updatedAt	models/chat.js	/^"use strict";var model_name="Chat";var table_name="chats";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},sender_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},admin_username:{type:Sequelize.STRING},message:{type:Sequelize.TEXT},is_read_by_user:{type:Sequelize.BOOLEAN,defaultValue:true},is_read_by_admin:{type:Sequelize.BOOLEAN,defaultValue:true},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	p
opts.updatedAt	models/muted_device.js	/^"use strict";var model_name="MutedDevice";var table_name="muted_devices";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},muted_at:{type:Sequelize.DATE},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	p
os	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	v
renderChatButtons	assets/scripts/admin/chat_plugin_ctrl.js	/^    <\/div>`;if($("#chat-plugin").length<=0)$("body").append(chat_plugin);var App=angular.module("Plugins");App.controller("ChatPluginCtrl",function($scope,toastr,CatchHttpError,$timeout){$scope.toggleContacts=function(){$scope.showContacts=!$scope.showContacts};$scope.focusChat=function(contact){$scope.active_contact=contact;$(".device-"+contact.id+" .unread-indicator").hide()};$scope.closeChat=function(){$scope.active_contact=null}});function renderChatButtons(){var list=$("all-devices table tbody tr");if(!list.length)return;var contactScope=angular.element(".contacts-bar").scope();$.get("\/chat-plugin\/unread-device-ids").then(function(data){for(var i=0;i<list.length;i++){let tr=$(list[i]);let td=tr.children().last();if(!td.children(".init-chat").length){let scope=angular.element(tr).scope();let device=scope.c;let chatBtn='<button class="btn btn-info btn-xs init-chat device-'+device.id+'" title="Chat"><i class="fa fa-envelope-o"><\/i>';let hasUnread=data.includes(device.id);chatBtn+='<i class="unread-indicator" style="display:'+(hasUnread?"inline":"none")+';position:absolute;color:red;font-size:30px;margin-top:-14px;">*<\/i>';chatBtn+="<\/button>";chatBtn=$(chatBtn);td.append(chatBtn);chatBtn.on("click",function(){$(this).children(".unread-indicator").hide();var _device=contactScope.devices.find(function(d){return d.id==device.id});if(!_device)_device=device;contactScope.focusChat(_device)})}}})}var MainApp=angular.module("adopisoft");MainApp.config(function($httpProvider){$httpProvider.interceptors.push("clientsLoadFilter")}).factory("clientsLoadFilter",function($q,$rootScope){var service={request:function(d){return d},response:function(d){var url=((d||{}).config||{}).url||"";if(!d.data)return d;if(!url.includes("\/settings\/clients"))return d;setTimeout(function(){renderChatButtons()});return d},responseError:function(rejection){return $q.reject(rejection)}};return service})})();/;"	f
resizeConversationCon.closeChatBox	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
resizeConversationCon.openChatBox	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
router	index.js	/^var config=require(".\/config");var router=require(".\/router");var models=require(".\/models");var{app}=require("plugin-core");module.exports={async init(id){config.id=id;await models.init();app.use(router)},uninstall(){}};/;"	v
scrollToBottom.formatChat	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
scrollToBottom.formatLoadMore	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
scrollToBottom.mute	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
scrollToBottom.promptAppInstallation	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
send_api_url	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	v
settings_api_url	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	v
table_name	models/chat.js	/^"use strict";var model_name="Chat";var table_name="chats";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},sender_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},admin_username:{type:Sequelize.STRING},message:{type:Sequelize.TEXT},is_read_by_user:{type:Sequelize.BOOLEAN,defaultValue:true},is_read_by_admin:{type:Sequelize.BOOLEAN,defaultValue:true},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	v
table_name	models/muted_device.js	/^"use strict";var model_name="MutedDevice";var table_name="muted_devices";var opts={createdAt:"created_at",updatedAt:"updated_at",underscored:true,timestamps:true,tableName:table_name};module.exports=(sequelize,Sequelize)=>{var model=sequelize.define(model_name,{id:{primaryKey:true,type:Sequelize.UUID,defaultValue:Sequelize.UUIDV4,allowNull:false,unique:true},machine_id:{type:Sequelize.STRING},mobile_device_id:{type:Sequelize.UUID},muted_at:{type:Sequelize.DATE},created_at:{allowNull:false,type:Sequelize.DATE},updated_at:{allowNull:false,type:Sequelize.DATE}},opts);return model};/;"	v
unmute.initChats	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
unmute.initSettings	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
unmute.loadMore	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
unmute.sendMessage	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
var.default_scope.where	models/index.js	/^"use strict";var{dbi,machine_id}=require("plugin-core");var Chat=require(".\/chat");var MutedDevice=require(".\/muted_device");var model_files={Chat:Chat,MutedDevice:MutedDevice};exports.init=async()=>{if(!dbi)return;var{sequelize,Sequelize}=dbi;var db=await sequelize.getInstance();var keys=Object.keys(model_files);for(var i=0;i<keys.length;i++){var k=keys[i];dbi.models[k]=model_files[k](db,Sequelize);try{await dbi.models[k].sync({alter:true})}catch(e){}}var default_scope={where:{machine_id:machine_id}};dbi.models.Chat.addScope("default_scope",default_scope);dbi.models.Chat.belongsTo(dbi.models.MobileDevice);dbi.models.MobileDevice.hasMany(dbi.models.Chat);dbi.models.MutedDevice.addScope("default_scope",default_scope);dbi.models.MutedDevice.belongsTo(dbi.models.MobileDevice);return dbi};/;"	p
xmlhttp.onload	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
xmlhttp.onreadystatechange	assets/scripts/portal/portal.js	/^var chats_api_url="\/chat-plugin\/portal\/chats";var send_api_url="\/chat-plugin\/portal\/chat";var device_api_url="\/client\/device";var settings_api_url="\/chat-plugin\/setting";var apk_download_prompt="We have an Android App for you to conveniently open the captive portal and to receive notifications. Click the download button below to install it. Disregard this message if you already installed it.";var apk_link="\/public\/plugins\/chat-plugin\/assets\/captive-portal.apk";var mark_read_api_url="\/chat-plugin\/portal\/mark-read";var chatBoxOpened=false;var device;var os;var hide_portal_button=false;function httpGet(url,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(cb)cb(xmlhttp.responseText)}};xmlhttp.open("GET",url,true);xmlhttp.send()}function httpPost(url,params,cb){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onload=function(){var data=xmlhttp.responseText;try{data=JSON.parse(xmlhttp.responseText)}catch(e){}if(cb)cb(data)};xmlhttp.open("POST",url,true);xmlhttp.setRequestHeader("Content-Type","application\/json");xmlhttp.send(JSON.stringify(params||{}))}function disconnected(){if(document.querySelector("li#disconnected"))return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="disconnected";li.style.textAlign="center";li.style.padding="20px";li.innerHTML="<a href='javascript:window.location.reload()'>Something went wrong? Click here to reload the page<\/a>";ul.append(li);scrollToBottom()}function reconnected(){var el=document.querySelector("li#disconnected");if(el)el.remove()}function hasUnread(){var el=document.querySelector(".unread-indicator");el.style.display=""}function hasRead(){var el=document.querySelector(".unread-indicator");el.style.display="none";return httpGet(mark_read_api_url)}function initChatBox(){var el=document.querySelector(".chat-box");if(!el)return;var width=Math.min(450,window.innerWidth-20);var height=Math.min(650,window.innerHeight-20);el.style.width=width+"px";el.style.height=height+"px";var textarea=document.querySelector(".chat-plugin .send-msg-con textarea");var twidth=width-58;textarea.style.width=twidth+"px";textarea.style.maxWidth=twidth+"px";textarea.style.minWidth=twidth+"px"}function resizeConversationCon(){document.querySelector(".chat-plugin .conversation").style.height="100%";var conv_con=document.querySelector(".chat-plugin .conversation");var send_msg_con=document.querySelector(".chat-plugin .send-msg-con");conv_con.style.height=conv_con.offsetHeight-(send_msg_con.offsetHeight+4)+"px"}var audio_url="\/public\/plugins\/chat-plugin\/assets\/sounds\/msg.mp3";var audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});function openChatBox(){if(!audio)audio=new Howl({src:[audio_url],loop:false,buffer:false,preload:true});var icon=document.querySelector(".main-icon");icon.style.display="none";var el=document.querySelector(".chat-box");el.style.display="";resizeConversationCon();scrollToBottom();chatBoxOpened=true;hasRead();var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display="none"}function closeChatBox(){var icon=document.querySelector(".main-icon");icon.style.display="";animateIcon();var el=document.querySelector(".chat-box");el.style.display="none";chatBoxOpened=false;var msgr=document.getElementById("wh-widget-send-button");if(msgr)msgr.style.display=""}function notify(msg){if(typeof AndroidFunction!="undefined"&&AndroidFunction.showNotification){AndroidFunction.showNotification(msg)}if(!window.Notification){return false}else if(Notification.permission==="granted"){var notification=new Notification(msg)}else if(Notification.permission!=="denied"){Notification.requestPermission().then(function(permission){if(permission==="granted"){var notification=new Notification(msg)}})}}function animateIcon(with_sound){var icon=document.querySelector(".main-icon i.fa");var max=60;var i=1;var interval=setInterval(function(){i+=1;icon.style["font-size"]=i+"px";if(i>=max)clearInterval(interval)},3);if(with_sound){if(audio)audio.play()}}function formatDate(date){var date=new Date(date);var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var ampm_str=hours+":"+minutes+ampm;var mm_dd_yy=[date.getMonth()+1,date.getDate(),date.getFullYear()].join("\/");return mm_dd_yy+" "+ampm_str}function capitalize(name){return name.substr(0,1).toUpperCase()+name.substr(1,name.length)}function scrollToBottom(el){if(!el)el=document.querySelector(".conversation");el.scrollTop=el.scrollHeight}function formatChat(chat){var li=document.createElement("li");li.id="message-"+chat.id;var innerHTML='<div class="message '+(chat.sender_id==device.id?"sent":"received")+'">';innerHTML=innerHTML+'<strong class="sender">'+capitalize(chat.sender_id==device.id?"You ("+(device.hostname||device.mac_address)+")":chat.admin_username)+"<\/strong><br\/>";innerHTML=innerHTML+'<pre class="text">'+chat.message.trim()+"<\/pre>";innerHTML=innerHTML+'<small class="time">'+formatDate(chat.created_at)+"<\/small><\/div>";li.innerHTML=innerHTML;return li}function formatLoadMore(){var li=document.createElement("li");li.innerHTML='<li><a class="message load-more" style="border-radius: 5px; display: inline-block; width: 100%; text-align: center;" onclick="loadMore(this)"><span class="text">Load more ...<\/span><\/a><\/li>';return li}function mute(){var input=document.querySelector("#chat_message");input.title="Muted";input.disabled=true}function unmute(){var input=document.querySelector("#chat_message");input.title="";input.disabled=false}function initSettings(cb){httpGet(settings_api_url,function(data){data=JSON.parse(data);if(data.apk_download_prompt)apk_download_prompt=data.apk_download_prompt;if(data.apk_link)apk_link=data.apk_link;hide_portal_button=data.hide_portal_button;if(cb)cb(data)})}var chats=[];function initChats(){var socket=Socket.getInstance();if(socket.disconnected)disconnected();socket.on("connection",function(){reconnected()});socket.on("disconnect",function(){disconnected()});socket.on("chat:mute",function(){mute();reconnected()});socket.on("chat:unmute",function(){unmute();reconnected()});httpGet(device_api_url,function(device_data){device=JSON.parse(device_data);httpGet(chats_api_url,function(data){var ul=document.querySelector(".conversation ul.list");data=JSON.parse(data);chats=data.chats;os=data.os;if(data.is_muted)mute();ul.innerHTML="";for(var i=0;i<chats.length;i++){var chat=chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}socket.on("chat",function(chat){var li=formatChat(chat);li.querySelector(".message").style.border="3px solid #5cb85b";li.classList.add("new-message");ul.append(li);setTimeout(function(){li.querySelector(".message").style.border=""},1e3);setTimeout(function(){li.classList.remove("new-message")},3e3);setTimeout(function(){scrollToBottom()});animateIcon(chat.sender_id!=device.id);setTimeout(function(){animateIcon()});if(chat.sender_id!=device.id){notify(capitalize(chat.admin_username)+": "+chat.message);if(window.JSInterface){window.JSInterface.messageReceived(chat.admin_username,chat.message)}}if(!chatBoxOpened){hasUnread()}else{hasRead()}reconnected()});var has_unread=chats.findIndex(function(c){return!c.is_read_by_user})>=0;if(has_unread)hasUnread()})});setTimeout(function(){if(window.warning_sound&&window.JSInterface){window.warning_sound.subscribe(function(p){var seconds=p.seconds||"";var standalone_time=p.standalone_time||"";var megabytes=p.megabytes||"";window.JSInterface.warning(seconds,standalone_time,megabytes)})}},5e3)}var page=1;var loading_more=false;function loadMore(el){if(loading_more)return;if(el&&el.remove)el.remove();page+=1;loading_more=true;httpGet(chats_api_url+"?page="+page+"&ref="+Math.random(),function(data){loading_more=false;data=JSON.parse(data);var _chats=data.chats;if(!_chats||_chats.length<=0)return;chats=_chats.concat(chats);var ul=document.querySelector(".conversation ul.list");for(var i=0;i<_chats.length;i++){var chat=_chats[i];ul.prepend(formatChat(chat))}if(chats.length<data.total_count){ul.prepend(formatLoadMore())}})}function sendMessage(e){e.preventDefault();var input=document.querySelector("#chat_message");var msg=input.value;input.value="";if(!msg)return;httpPost(send_api_url,{message:msg},function(res){});setTimeout(function(){if(!document.querySelector(".new-message")){disconnected()}},3e3);return false}function promptAppInstallation(){if(os!="android"||window.location.search=="?ad")return;var ul=document.querySelector(".conversation ul.list");var li=document.createElement("li");li.id="message-0";var innerHTML='<div class="message received">';innerHTML=innerHTML+'<strong class="sender">Admin<\/strong><br\/>';innerHTML=innerHTML+'<pre class="text" style="padding-bottom: 0;margin-bottom: 0;">'+apk_download_prompt+"<\/pre>";innerHTML=innerHTML+'<p style=" text-align: center; "><a style=" background: #209e91!important; color: white !important; padding: 10px; border-radius: 10px; display: inline-block; width: 210px; text-align: center; margin:10px;" href="'+apk_link+"?ref="+Math.random()+'">Download App<\/a><\/p>';innerHTML=innerHTML+'<small class="time">'+formatDate(new Date)+"<\/small><\/div>";li.innerHTML=innerHTML;ul.append(li);hasUnread();animateIcon(true)}(function(){"use strict";setTimeout(function(){if(!document.getElementById("chat-plugin")){var chat_plugin=document.createElement("div");chat_plugin.id="chat-plugin";httpGet("\/public\/plugins\/chat-plugin\/views\/portal\/chat.html?ref="+(new Date).getMonth(),function(html){chat_plugin.innerHTML=html;var body=document.querySelector("body");body.append(chat_plugin)})}},1e3);var i=setInterval(function(){var socket=Socket.getInstance();if(document.querySelector(".chat-box")&&socket){initSettings(function(){if(hide_portal_button){document.getElementById("chat-plugin").style.display="none";return false}initChatBox();initChats();animateIcon()});clearInterval(i)}},2e3);window.addEventListener("resize",function(){initChatBox();if(chatBoxOpened){resizeConversationCon();scrollToBottom(document.querySelector(".conversation"))}})})();/;"	f
